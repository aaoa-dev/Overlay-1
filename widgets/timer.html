<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stream Timer</title>
    <link rel="stylesheet" href="../output.css">
    <link rel="stylesheet" href="../styles/components/settings.css">
    <script>
        // Immediate theme initialization to prevent FOUC
        (function() {
            const getTheme = () => {
                const saved = localStorage.getItem('theme');
                if (saved && saved !== 'system') return saved;
                return window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';
            };
            const applyTheme = (theme) => {
                document.documentElement.classList.toggle('dark', theme === 'dark');
            };
            applyTheme(getTheme());
        })();
    </script>
    <style>
        body {
            margin: 0;
            padding: 0;
            overflow: hidden;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background: transparent;
        }

        #timer-container {
            text-align: center;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 1rem;
            color: hsl(var(--foreground));
        }

        #mode-indicator {
            font-size: 0.875rem;
            opacity: 0.7;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            color: inherit;
        }

        #timer-display {
            font-weight: bold;
            line-height: 1;
            font-variant-numeric: tabular-nums;
            color: inherit;
        }

        #timer-label {
            font-size: 1rem;
            opacity: 0.8;
            margin-top: 0.5rem;
            color: inherit;
        }

        #cycle-indicator {
            font-size: 0.875rem;
            opacity: 0.6;
            margin-top: 0.5rem;
            color: inherit;
        }

        #time-addition {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 2rem;
            font-weight: bold;
            opacity: 0;
            pointer-events: none;
            color: hsl(var(--primary));
            text-shadow: 0 0 10px hsl(var(--primary) / 0.5);
            animation: fadeInOut 2s ease-out;
        }

        @keyframes fadeInOut {
            0% { opacity: 0; transform: translate(-50%, -50%) scale(0.5); }
            20% { opacity: 1; transform: translate(-50%, -50%) scale(1.2); }
            80% { opacity: 1; transform: translate(-50%, -50%) scale(1); }
            100% { opacity: 0; transform: translate(-50%, -60%) scale(0.8); }
        }

        .pulse {
            animation: pulse 1s ease-in-out;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .warning {
            animation: warning-pulse 1s ease-in-out infinite;
        }

        @keyframes warning-pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }
    </style>
</head>
<body>
    <div id="timer-container">
        <div id="mode-indicator"></div>
        <div id="timer-display">00:00:00</div>
        <div id="timer-label"></div>
        <div id="cycle-indicator" style="display: none;"></div>
    </div>
    
    <div id="time-addition"></div>

    <!-- Settings Panel -->
    <div class="obs-hidden fixed top-4 left-4 flex flex-col gap-2 z-20">
        <button 
            id="toggle-settings" 
            class="settings-trigger"
            title="Timer Settings"
            aria-label="Open timer settings"
            aria-expanded="false"
            aria-controls="settings-panel"
        >
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543-.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"></path>
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
            </svg>
        </button>

        <div id="settings-panel" class="settings-panel hidden">
            <header class="settings-header">
                <h2 class="settings-title">Timer Settings</h2>
                <button id="reset-settings" class="reset-button">Reset</button>
            </header>

            <div class="settings-content">
                <!-- Mode Selection -->
                <section class="settings-section">
                    <h3 class="section-heading">Mode</h3>
                    <div class="settings-group">
                        <label class="control-label">Timer Mode</label>
                        <select id="mode-select" class="select-input">
                            <option value="countdown">Countdown</option>
                            <option value="countup">Count Up</option>
                            <option value="pomodoro">Pomodoro</option>
                            <option value="subathon">Subathon</option>
                            <option value="tipathon">Tipathon</option>
                            <option value="goalathon">Goalathon</option>
                            <option value="hype">Hype/Momentum</option>
                        </select>
                    </div>
                    <div class="settings-group">
                        <label class="control-label">Timer Name / ID (for commands)</label>
                        <input type="text" id="timer-name" placeholder="e.g. subathon" class="select-input">
                    </div>
                </section>

                <!-- Basic Timer Settings -->
                <section class="settings-section" id="basic-settings">
                    <h3 class="section-heading">Duration</h3>
                    <div class="settings-group">
                        <label class="control-label">Hours</label>
                        <input type="number" id="hours-input" min="0" max="99" value="0" class="select-input">
                    </div>
                    <div class="settings-group">
                        <label class="control-label">Minutes</label>
                        <input type="number" id="minutes-input" min="0" max="59" value="5" class="select-input">
                    </div>
                    <div class="settings-group">
                        <label class="control-label">Seconds</label>
                        <input type="number" id="seconds-input" min="0" max="59" value="0" class="select-input">
                    </div>
                </section>

                <!-- Pomodoro Settings -->
                <section class="settings-section" id="pomodoro-settings" style="display: none;">
                    <h3 class="section-heading">Pomodoro Cycle</h3>
                    <div class="settings-group">
                        <label class="control-label">Work Duration (minutes)</label>
                        <input type="number" id="work-duration" min="1" max="120" value="25" class="select-input">
                    </div>
                    <div class="settings-group">
                        <label class="control-label">Break Duration (minutes)</label>
                        <input type="number" id="break-duration" min="1" max="60" value="5" class="select-input">
                    </div>
                    <div class="settings-group">
                        <label class="control-label">Long Break (minutes)</label>
                        <input type="number" id="long-break-duration" min="1" max="60" value="15" class="select-input">
                    </div>
                    <div class="settings-group">
                        <label class="control-label">Cycles Before Long Break</label>
                        <input type="number" id="cycles-before-long" min="1" max="10" value="4" class="select-input">
                    </div>
                </section>

                <!-- Subathon Settings -->
                <section class="settings-section" id="subathon-settings" style="display: none;">
                    <h3 class="section-heading">Subscription Time</h3>
                    <div class="settings-group">
                        <label class="control-label">Minutes per Tier 1 Sub</label>
                        <input type="number" id="time-per-sub" min="0" max="60" value="2" step="0.5" class="select-input">
                    </div>
                    <div class="settings-group">
                        <label class="control-label">Minutes per Tier 2 Sub</label>
                        <input type="number" id="time-per-tier2" min="0" max="60" value="4" step="0.5" class="select-input">
                    </div>
                    <div class="settings-group">
                        <label class="control-label">Minutes per Tier 3 Sub</label>
                        <input type="number" id="time-per-tier3" min="0" max="60" value="10" step="0.5" class="select-input">
                    </div>
                    <div class="settings-group">
                        <label class="control-label">Minutes per Gift Sub</label>
                        <input type="number" id="time-per-gift" min="0" max="60" value="2" step="0.5" class="select-input">
                    </div>
                </section>

                <!-- Tipathon Settings -->
                <section class="settings-section" id="tipathon-settings" style="display: none;">
                    <h3 class="section-heading">Tip Configuration</h3>
                    <div class="settings-group">
                        <label class="control-label">Seconds per Dollar/Euro</label>
                        <input type="number" id="time-per-currency" min="1" max="600" value="60" class="select-input">
                    </div>
                    <div class="settings-group">
                        <label class="control-label">Minimum Tip Amount</label>
                        <input type="number" id="tip-minimum" min="0" max="100" value="1" step="0.5" class="select-input">
                    </div>
                </section>

                <!-- Goalathon Settings -->
                <section class="settings-section" id="goalathon-settings" style="display: none;">
                    <h3 class="section-heading">Milestones</h3>
                    <div class="settings-group">
                        <label class="control-label">Goal Type</label>
                        <select id="goal-type" class="select-input">
                            <option value="followers">Followers</option>
                            <option value="subscribers">Subscribers</option>
                            <option value="tips">Tips Amount</option>
                        </select>
                    </div>
                    <div class="settings-group">
                        <label class="control-label">Milestone Interval</label>
                        <input type="number" id="milestone-interval" min="1" max="10000" value="100" class="select-input">
                    </div>
                    <div class="settings-group">
                        <label class="control-label">Minutes per Milestone</label>
                        <input type="number" id="time-per-milestone" min="1" max="60" value="5" class="select-input">
                    </div>
                </section>

                <!-- Hype Settings -->
                <section class="settings-section" id="hype-settings" style="display: none;">
                    <h3 class="section-heading">Momentum</h3>
                    <div class="settings-group">
                        <label class="control-label">Decay Rate (seconds per minute)</label>
                        <input type="number" id="decay-rate" min="1" max="60" value="2" class="select-input">
                    </div>
                    <div class="settings-group">
                        <label class="control-label">Seconds Added per Chat Message</label>
                        <input type="number" id="activity-boost" min="1" max="60" value="5" class="select-input">
                    </div>
                    <div class="settings-group">
                        <label class="control-label">Seconds Added per Follow</label>
                        <input type="number" id="follow-boost" min="1" max="300" value="30" class="select-input">
                    </div>
                </section>

                <!-- Universal Settings -->
                <section class="settings-section">
                    <h3 class="section-heading">Behavior</h3>
                    <div class="settings-group">
                        <label class="control-label">At Zero</label>
                        <select id="at-zero" class="select-input">
                            <option value="stop">Stop</option>
                            <option value="loop">Loop</option>
                            <option value="pause">Pause</option>
                            <option value="hide">Hide</option>
                        </select>
                    </div>
                    <div class="settings-group">
                        <label class="control-label">Auto Start</label>
                        <input type="checkbox" id="auto-start" checked>
                    </div>
                    <div class="settings-group">
                        <label class="control-label">Enable Chat Commands</label>
                        <input type="checkbox" id="enable-commands" checked>
                    </div>
                </section>

                <section class="settings-section">
                    <h3 class="section-heading">Limits</h3>
                    <div class="settings-group">
                        <label class="control-label">Maximum Hours (0 = no limit)</label>
                        <input type="number" id="max-time" min="0" max="999" value="0" class="select-input">
                    </div>
                    <div class="settings-group">
                        <label class="control-label">Minimum Minutes (floor)</label>
                        <input type="number" id="min-time" min="0" max="999" value="0" class="select-input">
                    </div>
                </section>

                <!-- Display Settings -->
                <section class="settings-section">
                    <h3 class="section-heading">Display</h3>
                    <div class="settings-group">
                        <label class="control-label">Show Hours</label>
                        <input type="checkbox" id="show-hours" checked>
                    </div>
                    <div class="settings-group">
                        <label class="control-label">Show Mode Indicator</label>
                        <input type="checkbox" id="show-mode" checked>
                    </div>
                    <div class="settings-group">
                        <label class="control-label">Label</label>
                        <input type="text" id="timer-label" placeholder="Optional label" class="select-input">
                    </div>
                </section>

                <!-- Style Settings -->
                <section class="settings-section">
                    <h3 class="section-heading">Style</h3>
                    <div class="settings-group">
                        <label class="control-label">Font</label>
                        <div class="font-picker">
                            <button type="button" id="font-picker-trigger" class="font-picker-trigger">
                                <span id="selected-font">Inter</span>
                                <span class="font-picker-arrow">â–¼</span>
                            </button>
                            <div id="font-picker-dropdown" class="font-picker-dropdown">
                                <input type="text" id="font-search" class="font-search" placeholder="Search fonts...">
                                <div id="font-list" class="font-list"></div>
                            </div>
                        </div>
                    </div>
                    <div class="settings-group">
                        <label class="control-label">Size (px): <span id="font-size-value">64</span></label>
                        <input type="range" id="font-size" min="24" max="200" value="64" class="range-input">
                    </div>
                    <div class="settings-group">
                        <label class="control-label">Color</label>
                        <input type="color" id="color-picker" value="#ffffff" class="color-input">
                    </div>
                    <div class="settings-group">
                        <label class="control-label">Theme</label>
                        <div class="button-group">
                            <button type="button" class="button-group-item active" data-theme="light">Light</button>
                            <button type="button" class="button-group-item" data-theme="dark">Dark</button>
                            <button type="button" class="button-group-item" data-theme="transparent">Transparent</button>
                        </div>
                    </div>
                </section>

                <!-- Sound Settings -->
                <section class="settings-section">
                    <h3 class="section-heading">Sounds</h3>
                    <div class="settings-group">
                        <label class="control-label">Master Volume <span id="volume-value" class="value-display">50%</span></label>
                        <input type="range" id="setting-volume" min="0" max="100" value="50" class="range-input">
                    </div>
                    <div class="settings-group">
                        <label class="control-label">Start Sound</label>
                        <div class="flex gap-2">
                            <select id="sound-start" class="select-input">
                                <option value="none">None</option>
                                <option value="ui-confirm">UI Confirm</option>
                                <option value="soft-click">Soft Click</option>
                                <option value="digital-start">Digital Start</option>
                            </select>
                            <button id="test-sound-start" class="settings-button" style="padding: 0 1rem;">â–¶</button>
                        </div>
                    </div>
                    <div class="settings-group">
                        <label class="control-label">End / Break Start Sound</label>
                        <div class="flex gap-2">
                            <select id="sound-end" class="select-input">
                                <option value="none">None</option>
                                <option value="bell">Digital Bell</option>
                                <option value="chime">Modern Chime</option>
                                <option value="alarm">Classic Alarm</option>
                                <option value="success">Success Fanfare</option>
                            </select>
                            <button id="test-sound-end" class="settings-button" style="padding: 0 1rem;">â–¶</button>
                        </div>
                    </div>
                    <div class="settings-group">
                        <label class="control-label">Long Break Start Sound</label>
                        <div class="flex gap-2">
                            <select id="sound-long-break" class="select-input">
                                <option value="none">None</option>
                                <option value="celesta">Celesta Sparkle</option>
                                <option value="ambient-swell">Ambient Swell</option>
                                <option value="level-up">Level Up</option>
                            </select>
                            <button id="test-sound-long-break" class="settings-button" style="padding: 0 1rem;">â–¶</button>
                        </div>
                    </div>
                    <div class="settings-group">
                        <label class="control-label">Time Added (Lengthened)</label>
                        <div class="flex gap-2">
                            <select id="sound-add" class="select-input">
                                <option value="none">None</option>
                                <option value="pop">Bubble Pop</option>
                                <option value="coin">Retro Coin</option>
                                <option value="ding">Soft Ding</option>
                                <option value="sparkle">Sparkle</option>
                            </select>
                            <button id="test-sound-add" class="settings-button" style="padding: 0 1rem;">â–¶</button>
                        </div>
                    </div>
                    <div class="settings-group">
                        <label class="control-label">Time Removed (Shortened)</label>
                        <div class="flex gap-2">
                            <select id="sound-remove" class="select-input">
                                <option value="none">None</option>
                                <option value="swish">Swish</option>
                                <option value="descend">Descend</option>
                                <option value="error-buzz">Error Buzz</option>
                            </select>
                            <button id="test-sound-remove" class="settings-button" style="padding: 0 1rem;">â–¶</button>
                        </div>
                    </div>
                </section>

                <!-- Control Buttons -->
                <section class="settings-section">
                    <h3 class="section-heading">Controls</h3>
                    <div style="display: flex; gap: 0.5rem; flex-wrap: wrap;">
                        <button id="start-timer" class="settings-button">Start</button>
                        <button id="pause-timer" class="settings-button">Pause</button>
                        <button id="reset-timer" class="settings-button">Reset</button>
                        <button id="add-minute" class="settings-button">+1 Min</button>
                        <button id="sub-minute" class="settings-button">-1 Min</button>
                    </div>
                </section>

                <!-- Chat Commands Info -->
                <section class="settings-section">
                    <h3 class="section-heading">Chat Commands (Mods & Broadcaster)</h3>
                    <div style="font-size: 0.75rem; color: hsl(var(--muted-foreground)); line-height: 1.6;">
                        <div style="margin-bottom: 0.75rem;">
                            <strong style="color: hsl(var(--foreground));">Syntax:</strong><br>
                            <code style="background: hsl(var(--muted) / 0.3); padding: 0.125rem 0.375rem; border-radius: 0.25rem;">!timer [name] [action] [value]</code>
                        </div>
                        <div style="margin-bottom: 0.75rem;">
                            <strong style="color: hsl(var(--foreground));">Universal Actions:</strong><br>
                            â€¢ <code style="background: hsl(var(--muted) / 0.3); padding: 0.125rem 0.375rem; border-radius: 0.25rem;">start</code>, <code style="background: hsl(var(--muted) / 0.3); padding: 0.125rem 0.375rem; border-radius: 0.25rem;">pause</code>, <code style="background: hsl(var(--muted) / 0.3); padding: 0.125rem 0.375rem; border-radius: 0.25rem;">stop</code>, <code style="background: hsl(var(--muted) / 0.3); padding: 0.125rem 0.375rem; border-radius: 0.25rem;">reset</code>
                        </div>
                        <div>
                            <strong style="color: hsl(var(--foreground));">Value Actions:</strong><br>
                            â€¢ <code style="background: hsl(var(--muted) / 0.3); padding: 0.125rem 0.375rem; border-radius: 0.25rem;">add [min]</code>, <code style="background: hsl(var(--muted) / 0.3); padding: 0.125rem 0.375rem; border-radius: 0.25rem;">remove [min]</code>, <code style="background: hsl(var(--muted) / 0.3); padding: 0.125rem 0.375rem; border-radius: 0.25rem;">set [min]</code>
                        </div>
                        <div style="margin-top: 0.75rem; font-style: italic; opacity: 0.8;">
                            Examples:<br>
                            â€¢ <code style="background: hsl(var(--muted) / 0.3); padding: 0.125rem 0.375rem; border-radius: 0.25rem;">!timer start</code> (All timers)<br>
                            â€¢ <code style="background: hsl(var(--muted) / 0.3); padding: 0.125rem 0.375rem; border-radius: 0.25rem;">!timer subathon add 5</code> (Specific timer)
                        </div>
                        <div style="margin-top: 0.75rem; padding: 0.5rem; background: hsl(var(--primary) / 0.1); border-radius: 0.5rem; border-left: 3px solid hsl(var(--primary));">
                            <strong style="color: hsl(var(--primary));">ðŸ’¡ Cross-Widget Sync:</strong><br>
                            Commands broadcast to all timer instances using BroadcastChannel API
                        </div>
                    </div>
                </section>
            </div>
        </div>
    </div>

    <!-- OBS Copy Button -->
    <div class="obs-hidden fixed top-4 right-4 flex items-center gap-2 z-10">
        <button 
            id="copy-obs-url" 
            class="px-6 py-3 rounded-4xl bg-primary text-primary-foreground font-bold text-sm transition-all hover:scale-105 hover:shadow-2xl hover:shadow-primary/40 flex items-center gap-2"
        >
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 5H6a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2v-1M8 5a2 2 0 002 2h2a2 2 0 002-2M8 5a2 2 0 012-2h2a2 2 0 012 2m0 0h2a2 2 0 012 2v3m2 4H10m0 0l3-3m-3 3l3 3"></path>
            </svg>
            Copy OBS URL
        </button>
    </div>

    <script type="module" src="./timer.js"></script>
</body>
</html>

