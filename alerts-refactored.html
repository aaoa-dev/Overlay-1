<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="output.css" />
    <link rel="stylesheet" href="alerts.css" />
    <script src="tmi.js" type="text/javascript"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <script type="module" src="alerts-refactored.js"></script>
  </head>
  <body class="m-0 p-0 h-screen w-screen overflow-hidden">
    <!-- Stats Display -->
    <div id="statsDisplay" class="fixed top-4 left-4 z-50"></div>

    <!-- Alert Container -->
    <div id="alertContainer" class="fixed top-0 left-0 w-full h-full pointer-events-none">
      <!-- Alerts will be injected here -->
    </div>

    <!-- Control Panel -->
    <div class="fixed bottom-4 right-4 flex flex-col gap-2 z-50">
      <!-- Stats Controls -->
      <div class="flex gap-2 bg-black bg-opacity-50 p-2 rounded-lg">
        <button 
          onclick="window.streamStats && window.streamStats.incrementFollowers()"
          class="bg-purple-500 text-white px-3 py-2 rounded shadow hover:bg-purple-600 transition-colors text-sm"
          title="Increment Follower Count"
        >
          +1 Follower
        </button>
        <button 
          onclick="window.streamStats && window.streamStats.incrementSubs()"
          class="bg-pink-500 text-white px-3 py-2 rounded shadow hover:bg-pink-600 transition-colors text-sm"
          title="Increment Sub Count"
        >
          +1 Sub
        </button>
      </div>

      <!-- Test Buttons -->
      <div class="flex gap-2 flex-wrap max-w-md">
        <button 
          onclick="testAlert('new')" 
          class="bg-purple-500 text-white px-4 py-2 rounded-full shadow-lg hover:bg-purple-600 transition-colors text-sm"
        >
          Test New User
        </button>
        <button 
          onclick="testAlert('returning')" 
          class="bg-blue-500 text-white px-4 py-2 rounded-full shadow-lg hover:bg-blue-600 transition-colors text-sm"
        >
          Test Returning
        </button>
        <button 
          onclick="testAlert('milestone10')" 
          class="bg-green-500 text-white px-4 py-2 rounded-full shadow-lg hover:bg-green-600 transition-colors text-sm"
        >
          Test 10+ Visits
        </button>
        <button 
          onclick="testAlert('milestone50')" 
          class="bg-gray-400 text-white px-4 py-2 rounded-full shadow-lg hover:bg-gray-500 transition-colors text-sm"
        >
          Test 50+ Visits
        </button>
        <button 
          onclick="testAlert('milestone100')" 
          class="bg-yellow-500 text-white px-4 py-2 rounded-full shadow-lg hover:bg-yellow-600 transition-colors text-sm"
        >
          Test 100+ Visits
        </button>
      </div>
    </div>

    <script>
      // Test function for buttons
      function testAlert(type) {
        if (!window.alertsManager) {
          console.error('AlertsManager not initialized yet');
          return;
        }

        const testUsers = [
          { name: 'TestUser1', color: '#FF0000' },
          { name: 'TestUser2', color: '#00FF00' },
          { name: 'TestUser3', color: '#0000FF' },
          { name: 'TestUser4', color: '#FF00FF' },
          { name: 'TestUser5', color: '#FFFF00' }
        ];

        const randomUser = testUsers[Math.floor(Math.random() * testUsers.length)];
        const username = randomUser.name.toLowerCase();
        
        // Initialize user data if needed
        if (!window.alertsManager.userData[username]) {
          window.alertsManager.userData[username] = {
            count: 0,
            lastUsed: 0,
            hasChattedThisStream: false
          };
        }

        // Set visit count based on type
        let visitCount = 0;
        let milestoneCount = 0;
        
        if (type === 'new') {
          visitCount = 1;
        } else if (type === 'milestone100') {
          visitCount = 100;
          milestoneCount = 100;
        } else if (type === 'milestone50') {
          visitCount = 50;
          milestoneCount = 50;
        } else if (type === 'milestone10') {
          visitCount = 10;
          milestoneCount = 10;
        } else {
          visitCount = Math.floor(Math.random() * 9) + 2; // 2-9 visits
        }

        window.alertsManager.userData[username].count = visitCount;
        window.alertsManager.saveUserData();

        // Create and queue alert
        const alert = window.Alert.create(randomUser.name, randomUser.color, visitCount);
        window.alertsManager.alertQueue.add(alert, (alert) => {
          if (milestoneCount > 0) {
            window.alertsManager.triggerConfetti(milestoneCount);
          }
        });

        console.log(`Test alert queued: ${randomUser.name} - ${visitCount} visits`);
      }

      // Make Alert available globally for test function
      import('./components/Alert.js').then(module => {
        window.Alert = module.Alert;
      });
    </script>
  </body>
</html>

