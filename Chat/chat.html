<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="../output.css" />
    <link rel="stylesheet" href="chat.css" />
    <script src="../tmi.js" type="text/javascript"></script>
    <script type="module" src="chat.js"></script>
  </head>
  <body class="m-0 p-0 h-screen w-screen overflow-hidden bg-transparent">
    <div id="chatContainer" class="fixed bottom-0 left-0 w-96 max-h-screen p-4 space-y-2 overflow-y-auto">
      <!-- Chat messages will be injected here -->
    </div>

    <!-- Auth controls -->
    <div class="fixed top-4 right-4">
      <a href="/auth/oauth.html" id="auth-link" class="bg-purple-500 text-white px-4 py-2 rounded-full shadow-lg hover:bg-purple-600 transition-colors text-sm inline-flex items-center gap-2">
        <svg class="w-4 h-4" viewBox="0 0 24 24" fill="white">
          <path d="M11.571 4.714h1.715v5.143H11.57zm4.715 0H18v5.143h-1.714zM6 0L1.714 4.286v15.428h5.143V24l4.286-4.286h3.428L22.286 12V0zm14.571 11.143l-3.428 3.428h-3.429l-3 3v-3H6.857V1.714h13.714z"/>
        </svg>
        <span id="auth-status">Connect with Twitch</span>
      </a>
    </div>

    <!-- Test controls for development -->
    <div class="fixed bottom-4 right-4 flex gap-2">
      <button 
        onclick="globalThis.testMessage('regular')" 
        class="bg-blue-500 text-white px-4 py-2 rounded-full shadow-lg hover:bg-blue-600 transition-colors"
      >
        Test Regular Message
      </button>
      <button 
        onclick="globalThis.testMessage('sub')" 
        class="bg-purple-500 text-white px-4 py-2 rounded-full shadow-lg hover:bg-purple-600 transition-colors"
      >
        Test Sub Message
      </button>
    </div>
    
    <script>
      // Update auth link status
      document.addEventListener('DOMContentLoaded', () => {
        const authLink = document.getElementById('auth-link');
        const authStatus = document.getElementById('auth-status');
        const username = localStorage.getItem('twitch_username');
        
        if (username) {
          authStatus.textContent = `Logged in as ${username}`;
          authLink.classList.remove('bg-purple-500', 'hover:bg-purple-600');
          authLink.classList.add('bg-green-500', 'hover:bg-green-600');
          
          // Change to logout functionality
          authLink.addEventListener('click', (e) => {
            e.preventDefault();
            localStorage.removeItem('twitch_oauth_token');
            localStorage.removeItem('twitch_username');
            window.location.reload();
          });
        }
      });
    </script>
  </body>
</html>